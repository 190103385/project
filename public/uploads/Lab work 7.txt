--1st task
--Subtask A
CREATE PROCEDURE proc_country
(p_country_id IN countries.country_id%TYPE,
 p_country_name OUT countries.country_name%TYPE) IS
BEGIN
    SELECT country_name INTO p_country_name
    FROM countries
    WHERE country_id = p_country_id;
END proc_country;

--Subtask B
DECLARE
    v_country_name countries.country_name%TYPE;
BEGIN
    proc_country(p_country_id => 'US', p_country_name => v_country_name);
    DBMS_OUTPUT.PUT_LINE('Name of the country is ' || v_country_name);
    proc_country('JP', v_country_name);
    DBMS_OUTPUT.PUT_LINE('Name of the country is ' || v_country_name);
    proc_country('UK', p_country_name => v_country_name);
    DBMS_OUTPUT.PUT_LINE('Name of the country is ' || v_country_name);
EXCEPTION
    WHEN NO_DATA_FOUND THEN
    DBMS_OUTPUT.PUT_LINE('No such country, try other ID');
END;


--2nd task
CREATE OR REPLACE PROCEDURE ins_upd_users
(
    p_id IN OUT users.id%TYPE,
    p_name IN users.name%TYPE,
    p_birthdate IN users.birthdate%TYPE,
    p_isactive IN users.isactive%TYPE
) 
AS
v_user users%ROWTYPE;
BEGIN
    SELECT * INTO v_user FROM users
    WHERE id = p_id;
    
    IF p_id IS null THEN
        INSERT INTO users VALUES (null, p_name, p_birthdate, p_isactive);
    ELSE
        UPDATE users
            SET name = p_name, birthdate = p_birthdate, isactive = p_isactive
            WHERE id = p_id AND
                EXISTS(SELECT * FROM users
                    WHERE id = p_id);
    END IF;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        INSERT INTO users VALUES (p_id, p_name, p_birthdate, p_isactive);
        DBMS_OUTPUT.PUT_LINE('No data found. ' || SQL%ROWCOUNT || ' new rows inserted.');
END ins_upd_users;


--3rd task
CREATE OR REPLACE PROCEDURE del_users
(
    p_id IN OUT users.id%TYPE
)
AS
v_isactive users.isactive%TYPE;
BEGIN
SELECT isactive INTO v_isactive FROM users
        WHERE id = p_id;
    IF v_isactive = 0 THEN
        DELETE FROM users
            WHERE id = p_id;
    ELSE
        UPDATE users
            SET isactive = 0
            WHERE id = p_id;
    END IF;
END del_users;